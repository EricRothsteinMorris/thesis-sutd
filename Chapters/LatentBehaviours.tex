%!TEX root = ../main.tex
% Chapter Template


\chapter{Latent Behaviours} % Main chapter title
\label{ch:LatentBehaviours} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}
\todo[inline]{Find a suitable quote?}
\begin{quote}
If you only do what you can do, you will never be more than what you are now.
\end{quote}

\section{Introduction}
\todo[inline]{Give an interesting motivational example: What is the notion of latent behaviour? Why do we care about them? How is it useful to study them?}
\section{Mutation $F$-coalgebras}
\section{The Latent Behaviours of $F$-coalgebras}
Informally, a latent behaviour is a behaviour that a system could display if, for whatever reason, its state is constantly being altered but its dynamics is not. 
%For the functor $\Functor$, the monad $\Monad=(\MFunctor,\eta,\mu)$, and a $\lambda$-bialgebra $\Bialgebra=(X,a,c)$, we can define the behaviour associated to $\Bialgebra$ by means of the semantic mapping in the category of $\Functor$-coalgebras, i.e., by means of $\TheBehaviourOf{\cdot}\colon \MFunctor(X)\rightarrow \sigma\Functor$. 
%The \emph{latent behaviour} given a mutation coalgebra $\mathbb{M}=(X,X\xrightarrow{(o_m,\delta_m)} F(X))$, is modelled by the function $\TheLatentBehaviourOf{\cdot}{\mathbb{M}}\colon X\rightarrow \sigma F$, which is coinductively defined, for $i\in I$, by
%\begin{align}
%o(\TheLatentBehaviourOf{x}{\mathbb{M}})&\triangleq o_m(x)\\
%\delta(\TheLatentBehaviourOf{x}{\mathbb{M}})(i)&\triangleq \TheLatentBehaviourOf{\delta_m(x)(i)}{\mathbb{M}}.
%\end{align}
%The mutation $a$ skews the behaviour of states to reflect the changes to the state. 
Given a mutation function $m\colon X\rightarrow X$, we can skew the normal behaviour of $\mathbb{X}$ by defining the $F$-coalgebra $\mathbb{X}\circ m=(X,{(o\circ m, \delta\circ m }))$, which we refer to as the \emph{latent coalgebra of $\mathbb{X}$ under $m$}. The \emph{latent behaviour map} of $\mathbb{X}$ under $m$ is given by the function $\TheLatentBehaviourOfIn{\cdot}{m}{\mathbb{X}}\colon X\rightarrow \sigma F$, which corresponds to the semantic mapping for $\mathbb{X}\circ m$; that is, for $x\in X$, 
\begin{align}
\TheLatentBehaviourOfIn{x}{m}{\mathbb{X}}\triangleq\TheBehaviourOfIn{x}{{\mathbb{X}\circ m}}
\end{align}
\todo[inline]{Having functions from $X$ to $X$ without changing their coalgebra is kinda odd. But I think that is the spirit of latent behaviours! If you could do anything (e.g., change the coalgebra), then why would you reuse anything from the original coalgebra? We are questioning how far we can go by just changing the state.}

\begin{example}
\label{ex:LatentBehaviour}
Consider the functor $G=2\times \texttt{id}^2$ and a $G$-coalgebra $\mathbb{X}=(3,(\gamma,\delta))$ that can be used to recognise sequences of zeroes and ones that end in two consecutive ones when started at state 0., i.e. the language $(0+1)^*111^*$. Figure~\ref{fig:ExampleLatent} shows the automaton corresponding to the $G$-coalgebra $\mathbb{X}$ if $\gamma$ and $\delta$ are defined as follows
\begin{align}
\gamma(x)=\begin{cases}
1, \quad \text{if  $x=1$,}\\
0, \quad \text{otherwise;}\\
\end{cases},\quad
\delta(x)(i)=\begin{cases}
\texttt{min}(x+1,2), \quad \text{if  $i=1$,}\\
0, \quad \text{otherwise;}\\
\end{cases}.
\end{align}

\begin{figure}[t]
\centering
\begin{tikzpicture}
\node[state] (00) {$(0,0)$};
\node[state, accepting, below right of=00] (01) {$(0,1)$};
\node[state, above right  of=00] (10) {$(1,0)$};
\node[state, below right of=10] (11) {$(1,1)$};
\draw (00) edge[bend left, above] node{1} (10)
(00) edge[loop above] node{0} (00)
(01) edge[bend left, above] node{1} (11)
(01) edge[loop above] node{0} (01)
(10) edge[loop above] node{1} (10)
(10) edge[bend left, above] node{0} (00)
(11) edge[bend left, above] node{1} (10)
(11) edge[bend left, above] node{0} (00)
;\end{tikzpicture}
\caption{Corresponding automaton to the $G-$coalgebra described in Example~\ref{ex:LatentBehaviour}.}
\label{fig:ExampleLatent}
\end{figure}

\begin{figure}[t]
\centering
\begin{tikzpicture}
\node[state] (00) {$(0,0)$};
\node[state, below right of=00] (01) {$(0,1)$};
\node[state, above right  of=00] (10) {$(1,0)$};
\node[state, accepting, below right of=10] (11) {$(1,1)$};
\draw (00) edge[bend left, above] node{1} (10)
(00) edge[loop above] node{0} (00)
(01) edge[bend left, above] node{1} (10)
(01) edge[bend left, above] node{0} (00)
(10) edge[bend left, above] node{1} (11)
(10) edge[bend left, above] node{0} (01)
(11) edge[loop above] node{1} (11)
(11) edge[bend left, above] node{0} (01)
;\end{tikzpicture}
\caption{Corresponding automaton to the $G-$coalgebra described in Example~\ref{ex:LatentBehaviour}.}
\label{fig:ExampleLatent}
\end{figure}

This $G$-coalgebra has 27 mutations, given by the 27 endofunctions in $X$. We present the automata that correspond to latent $G-$coalgebras in Figures~\ref{fig:3.2}--\ref{fig:3.28}. Note that many of these latent coalgebras are not minimal, and many display the same behaviours.

From 27 endofuctions and three intended behaviours, we can derive the 24 latent behaviours presented in Table~\ref{tab:ExampleLatentBehaviours} as regular expressions. 

The existence of these latent behaviours opens a new possibility for system repurposing: if we wanted the system to recognise the language $(0+1)^*1$ (i.e., the language of sequences that end in 1), we could mutate our original system using a mutation where $0\mapsto0, 1\mapsto2$ and $2\mapsto2$ (shown in Figure~\ref{fig:3.10}), whilst preserving $0$ as the initial state. Nevertheless, if providing the mutation is within the capabilities of an adversary, it would also mean that they can repurpose our system as well. 

\begin{table}[t]
\centering
\begin{tabular}{|l | l | }
\hline
$\rho_{\ref{fig:3.2}.0}$ &  $\emptyset$   \\
$\rho_{\ref{fig:3.4}.2}$ &  $1^*$ \\
$\rho_{\ref{fig:3.7}.0}$ &  $(0+1)^*111^*$\\%$(0+10+111^*0)^*111^*$ \\
$\rho_{\ref{fig:3.7}.1}$ &  $\rho_{\ref{fig:3.7}.0}+1$ \\
$\rho_{\ref{fig:3.7}.2}$ &  $\rho_{\ref{fig:3.7}.0}+1+\varepsilon$ \\
$\rho_{\ref{fig:3.8}.1}$ &  $(00^*1+10^*1)^*$ \\
$\rho_{\ref{fig:3.8}.0}$ &  $0^*1\rho_{\ref{fig:3.8}.1}$ \\
$\rho_{\ref{fig:3.9}.2}$& $(0+1)^*01$\\
$\rho_{\ref{fig:3.9}.0}$&   $\rho_{\ref{fig:3.9}.2}+1$\\
$\rho_{\ref{fig:3.9}.1}$&   $\rho_{\ref{fig:3.9}.2}+1+\varepsilon$\\
$\rho_{\ref{fig:3.10}.0}$ &  $(0+1)^*1$ \\
$\rho_{\ref{fig:3.10}.1}$ &  $\rho_{\ref{fig:3.10}.0}+\varepsilon$ \\
$\rho_{\ref{fig:3.13}.1}$ &  $1^*0\rho_{\ref{fig:3.10}.0}$ \\
$\rho_{\ref{fig:3.17}.0}$ &  $(0+10+(11)^+(0+10))^*(11)^+$ \\
$\rho_{\ref{fig:3.17}.1}$ &  $(11)^*+(0+10)\rho_{\ref{fig:3.17}.0}$ \\
$\rho_{\ref{fig:3.17}.2}$ &  $0\rho_{\ref{fig:3.17}.0}+1\rho_{\ref{fig:3.17}.1}$ \\
$\rho_{\ref{fig:3.18}.0}$ &  $\varepsilon$ \\
$\rho_{\ref{fig:3.20}.1}$ &  $(0+1)^*0$ \\
$\rho_{\ref{fig:3.20}.0}$ &  $\rho_{\ref{fig:3.20}.1}+\varepsilon$ \\
$\rho_{\ref{fig:3.22}.0}$ &  $(1+0)^*$ \\
$\rho_{\ref{fig:3.22}.1}$ &  $1^*0(1+0)^*$ \\
$\rho_{\ref{fig:3.25}.1}$ &  $1(1+0)^*+0(1+0)^*$ \\
$\rho_{\ref{fig:3.26}.0}$ &  $(0+10+11)^*$ \\
$\rho_{\ref{fig:3.26}.2}$ &  $(0+1)\rho_{\ref{fig:3.26}.0}$\\
\hline
\end{tabular}
\caption{Latent behaviours for all mutations for the coalgebra that recognises $(0+1)^*11$. }
\label{tab:ExampleLatentBehaviours}
\end{table}

%$\rho_{\ref{fig:3.8}.0}$ &  $$ \\
%$\rho_{\ref{fig:3.8}.1}$ &  $$ \\
%$\rho_{\ref{fig:3.8}.2}$ &  $$ \\
%------------------------------------------------------------------------------------------------------------------------
\begin{figure}[t]
\centering
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop above] node{1} (q2)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,0),(2,0)}$. $\TheLatentBehaviourOf{0}{m}=\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$ }
\label{fig:3.2}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop above] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,0),(2,1)}$. $\TheLatentBehaviourOf{0}{m}=\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}
\label{fig:3.3}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop above] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,0),(2,2)}$. $\TheLatentBehaviourOf{0}{m}=\TheLatentBehaviourOf{1}{m}=\emptyset$, $\TheLatentBehaviourOf{2}{m}=1^*$}
\label{fig:3.4}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,1),(2,0)}$ . $\TheLatentBehaviourOf{0}{m}=\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,1),(2,1)}$ . $\TheLatentBehaviourOf{0}{m}=\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state,accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,1),(2,2)}$ (i.e. $m=\texttt{id}$). Latent behaviours under $m$ are the original behaviours: 
\protect\begin{align*}
	\TheLatentBehaviourOf{0}{m}&=(0+1)^*111^*, \\
	\TheLatentBehaviourOf{1}{m}&=1+\TheLatentBehaviourOf{0}{m}\\
	\TheLatentBehaviourOf{2}{m}&=\varepsilon + 1+ \TheLatentBehaviourOf{0}{m}
\protect\end{align*}
}
\label{fig:3.7}
\end{figure}



\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,2),(2,0)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{2}{m}=0^*1\TheLatentBehaviourOf{1}{m},\\
\TheLatentBehaviourOf{1}{m}&=(00^*1+10^*1)^*
\protect\end{align*}
\label{fig:3.8}
}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,2),(2,1)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=1+\TheLatentBehaviourOf{2}{m},\\
\TheLatentBehaviourOf{1}{m}&=\varepsilon+1+\TheLatentBehaviourOf{2}{m},\\
\TheLatentBehaviourOf{2}{m}&=(0+1)^*01
\protect\end{align*}
\label{fig:3.9}
}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, accepting,right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q2)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,0),(1,2),(2,2)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*1,\\ 
\TheLatentBehaviourOf{1}{m}&=\TheLatentBehaviourOf{2}{m}=\varepsilon + \TheLatentBehaviourOf{0}{m}
\protect\end{align*}
\label{fig:3.10}
}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,0),(2,0)}$. $\TheLatentBehaviourOf{0}{m}=
\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,0),(2,1)}$. $\TheLatentBehaviourOf{0}{m}=
\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}


\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state,accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,0),(2,2)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*1,\\ 
\TheLatentBehaviourOf{1}{m}&=1^*0\TheLatentBehaviourOf{0}{m},\\
\TheLatentBehaviourOf{2}{m}&=\varepsilon+\TheLatentBehaviourOf{0}{m}
%\TheLatentBehaviourOf{2}{m}&=1^*+\TheLatentBehaviourOf{1}{m}
\protect\end{align*}
}
\label{fig:3.13}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,1),(2,0)}$. $\TheLatentBehaviourOf{0}{m}=
\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}


\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,1),(2,1)}$. $\TheLatentBehaviourOf{0}{m}=
\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=\emptyset$}


\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,1),(2,2)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{1}{m}=(0+1)^*1,\\ 
\TheLatentBehaviourOf{2}{m}&=\TheLatentBehaviourOf{0}{m}+\varepsilon
\protect\end{align*}
}
\end{figure}

\begin{figure}[t]
\centering
\captionsetup{singlelinecheck=off}
\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$}; 
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,2),(2,0)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+10+(11)^+(0+10))^*(11)^+ \\ %(0+1(0+1(11)^*(0+10)))^*11(11)^* ,\\ 
\TheLatentBehaviourOf{1}{m}&=(11)^*+(0+10)\TheLatentBehaviourOf{0}{m},\\
\TheLatentBehaviourOf{2}{m}&=0\TheLatentBehaviourOf{0}{m}+1\TheLatentBehaviourOf{1}{m}
\protect\end{align*}
\label{fig:3.17}
}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,2),(2,1)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{2}{m}=\emptyset,\\ 
\TheLatentBehaviourOf{1}{m}&=\varepsilon
\protect\end{align*}
\label{fig:3.18}
}

\begin{tikzpicture}
\node[state] (q1) {$0$};
\node[state,accepting, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,1),(1,2),(2,2)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*1,\\
\TheLatentBehaviourOf{1}{m}&=\TheLatentBehaviourOf{2}{m}=\varepsilon+\TheLatentBehaviourOf{0}{m}
\protect\end{align*}
}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,0),(2,0)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*0+\varepsilon ,\\ 
\TheLatentBehaviourOf{1}{m}&=(0+1)^*0
\protect\end{align*} 
\label{fig:3.20}
}

\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,0),(2,1)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*0+\varepsilon ,\\ 
\TheLatentBehaviourOf{1}{m}&=(0+1)^*0
\protect\end{align*}
}

\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[loop right] node{1} (q2)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,0),(2,2)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{2}{m}=(0+1)^*,\\ 
\TheLatentBehaviourOf{1}{m}&=1^*0\TheLatentBehaviourOf{0}{m}
\protect\end{align*}
\label{fig:3.22}
}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,1),(2,0)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*0+\varepsilon,\\ 
\TheLatentBehaviourOf{1}{m}&=\TheLatentBehaviourOf{2}{m}=(0+1)^*0\\
\protect\end{align*}
}

\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,1),(2,1)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=(0+1)^*0+\varepsilon,\\ 
\TheLatentBehaviourOf{1}{m}&=\TheLatentBehaviourOf{2}{m}=(0+1)^*0\\
\protect\end{align*}
}

\begin{tikzpicture}
\node[state, accepting] (q1) {$0$};
\node[state, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,1),(2,2)}$ . 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{2}{m}=(0+1)^*,\\ 
\TheLatentBehaviourOf{1}{m}&=0\TheLatentBehaviourOf{0}{m}+1\TheLatentBehaviourOf{2}{m}
\protect\end{align*}
\label{fig:3.25}
}
\end{figure}

\begin{figure}[t]
\captionsetup{singlelinecheck=off}
\centering
\begin{tikzpicture}
\node[state,accepting] (q1) {$0$};
\node[state, accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[bend left, above] node{1} (q2)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,2),(2,0)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{1}{m}=(0+10+11)^*,\\ 
\TheLatentBehaviourOf{2}{m}&=(0+1)\TheLatentBehaviourOf{0}{m}
\protect\end{align*}
\label{fig:3.26}
}

\begin{tikzpicture}
\node[state,accepting] (q1) {$0$};
\node[state, accepting, right of=q1] (q2) {$1$};
\node[state, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,2),(2,1)}$.
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{1}{m}=(0+1)^*0+\varepsilon\\ 
\TheLatentBehaviourOf{2}{m}&=(0+1)^*0
\protect\end{align*}
}

\begin{tikzpicture}
\node[state,accepting] (q1) {$0$};
\node[state, accepting, right of=q1] (q2) {$1$};
\node[state, accepting, right of=q2] (q3) {$2$};
\draw (q1) edge[loop above] node{0} (q1)
(q1) edge[bend left, above] node{1} (q3)
(q2) edge[bend left, above] node{0} (q1)
(q2) edge[bend left, above] node{1} (q3)
(q3) edge[loop above] node{1} (q3)
(q3) edge[bend left, below] node{0} (q1);
\end{tikzpicture}
\caption{Latent coalgebra under graph $G(m)=\set{(0,2),(1,2),(2,2)}$. 
\protect\begin{align*}
\TheLatentBehaviourOf{0}{m}&=\TheLatentBehaviourOf{1}{m}=\TheLatentBehaviourOf{2}{m}=(0+1)^*
\protect\end{align*}
}
\label{fig:3.28}
\end{figure}

\end{example}
\todo[inline]{If we want $a$ to change with time there is no need to do anything fancy! We can enhance the carrier by doing $X'=X\times \mathbb{N}$ or $X'=X\times [X\rightarrow 2]$; with this, $X$ is enhanced by a natural number counter or a set of conditions to make the dynamics of the mutation coalgebra more interesting. Maybe there is even no need to do changes, it all depends on how informative $X$ is. let's see}

\section{Latent Vulnerabilities}
Not all behaviours are latent for a given $F$-coalgebra. In Example~\ref{ex:LatentBehaviour}, we see that no mutation can yield the language $0^*$ as a latent behaviour. We see latent behaviours as targets for attackers, and we would like to know if there is a way for an attacker to cause the system to shift to a particular latent behaviour by means of a mutation. For that purpose, we introduce the definition of {latent vulnerability problems}.

\begin{definition}
A \emph{latent vulnerability problem} consists of a given a pointed $F$-coalgebra $\mathbb{X}=(X,c,x_0)$ and a given behaviour $\rho\in \sigma F$. To solve this problem, we need to either 1) find a mutation $m$ which proves that $\rho$ is the latent behaviour of $x_0$ under $m$ or 2) prove that no such $m$ can exist.
\end{definition}

To coinductively define $m$, we would already need to know $\mathbb{X}\circ m$, so that is not an option. Instead, we can play a game with the coalgebra as follows. We start at the initial state $x_0$, and we take turns; we play first, and we are allowed to map $x_0$ to another state (i.e. define $m(x_0)$. Once we do, the coalgebra computes $c(m(x_0))$ and, on input consumed, and if the coalgebra has transition dynamics, we can continue the game from the new state.

\todo[inline]{Can we define  $\mathbb{X}\circ m$ based on what we know?. Let us consider the functor $O\times X^I$. We can try to solve the problem in two ways: based on bisimilarity or based on backpropagation (which are somewhat connected).}


\begin{align}
\gamma(m(x))&=\gamma_\omega(\rho)\\
\delta(m(x))(i)&\sim \delta_\omega(\rho)(i), \forall i\in I
\end{align}

\todo[inline]{This means that the problem becomes a "searching for the next candidate at every step" problem. Alternatively, you could learn to compose solutions too. }
\todo[inline]{Maybe we can also do something exciting: eventuality -> at some point in time, the behaviour you want becomes apparent, i.e. $\TheBehaviourOf{x_0}^w=\rho$ for some $w$}

 
\section{Attackers and Attacks}
There is an attacker model associated with latent vulnerabilities: attackers that can change the value of state variables, but not the program that defines the system. This later attacker would correspond to one that can arbitrarily change the coalgebra, and is in that sense a much stronger attacker. If the attacker can enforce any behaviour they want, it becomes too powerful to defend against; all coalgebras are vulnerable, and no fix is available. However, an attacker that exploits a latent vulnerability is a bit in the middle: it can change the coalgebra by means of a mutation/attack function, but only through those. In that sense, not every behaviour is at the reach of the attacker, only those who are latent.

We can do a further refinement: we can imagine attackers that control particular components of a state by partitioning states into controllable parts and observable parts
\todo[inline]{Is there a difference? We could show that every attacker that controls a component induces a mutation, and all mutations can be modelled by attackers that control a certain number of components. Right?}

\begin{definition}[Attack]
Given an $F$-coalgebra $(X,c)$ for the functor $F$, we define the set of its possible attacks as the set of endofunctions in $X$ with finite support, denoted $X^X_\omega$ (a function $f\colon X \rightarrow X$ has finite support iff $f(x)\neq x$ for a finite number of $x\in X$.)
\end{definition}

Intuitively, an attacker can be modelled by the set of attacks they have at their disposal. However, we avoid defining attackers by enumerating their attacks, since there may be infinite, and instead we will define them by the set of components of the system that they control. 

\begin{definition}[Attacker]
Given a functor $F$ and an $F$-coalgebra $\mathbb{X}=(\vec{X},c)$, such that $\vec{X}$ has components $\Pi=\set{\pi_1, \ldots, \pi_n}$, an \emph{attacker} of $\mathbb{X}$, say $A$, is a {finite} subset of $\Pi$ whose semantics is a set of attacks defined by the function $\texttt{attacks}\colon \TheFinitePowersetOf{\Pi}\rightarrow\ThePowersetOf{X^X_\omega}$ as follows. 
For $j\in \set{1, \ldots,  n}$,  
\begin{align}
\texttt{attacks}(A)=\set{f\in X^X_\omega | \text{ if $\pi_j \not\in A$, then $f(x)[\pi_j]=x[\pi_j]$, for all $x\in X$}}.
\end{align}
{\color{red}
equivalently
\begin{align}
\texttt{attacks}(A)=\set{f\in X^X_\omega | \text{if $f(x)[\pi_j]\neq x[\pi_j]$, then $\pi_j \in A$, for all $x\in X$}}.
\end{align}
}
In other words, we associate to $A$ the set of attacks where, if $A$ does not contain the component $\pi_j$, then the attacks cannot change the value of $\pi_j$ when mutating states.
 \end{definition}
 \todo[inline]{Commented is the definition with ranges, but it is kinda complicated. For spectre, we define the strategy first, then we think of what attacker we are, and for vulnerabilities, we will define the attacker first, and then we find the strategy.}
% 
% \begin{definition}[Attacker]
%Given a functor $F$ and an $F$-coalgebra $\mathbb{X}=(\vec{X},c)$, such that $\vec{X}$ has components $\Pi=\set{\pi_1, \ldots, \pi_n}$, an \emph{attacker} of $\mathbb{X}$, say $A$, is a pairing of a {finite} subset of $\Pi$, namely $A[\Pi]$, and a map $A[\texttt{range}]$ that associates each component in $A[\Pi]$ with a range of possible values; formally, $A[\texttt{range}(\pi_j)]\subseteq \Pi_j$, for all $\pi_j \in A[\Pi]$. %Formally, the type of attackers is $\TheFinitePowersetOf{\Pi} \times \ThePowersetOf{\Pi \times \vec{X}}$
%
%The semantics of an attacker is given by the set of attacks defined by the function $\texttt{attacks}\colon \texttt{Attackers}\rightarrow\ThePowersetOf{X^X_\omega}$ as follows. 
%For $j\in \set{1, \ldots,  n}$,  
%\begin{align}
%\texttt{attacks}(A)&\triangleq\set{f\in X^X_\omega | \text{ if $\pi_j \not\in A$, then $f(x)[\pi_j]=x[\pi_j]$, for all $x\in X$}}\cap\\
%&\set{f\in X^X_\omega | \text{ if $\pi_j \in A$, then $f(x)[\pi_j]\in \texttt{control}(A)(\pi_j)$, for all $x\in X$}}
%\end{align}
%{\color{red}
%equivalently
%\begin{align}
%\texttt{attacks}(A)=\set{f\in X^X_\omega | \text{if $f(x)[\pi_j]\neq x[\pi_j]$, then $\pi_j \in A$, for all $x\in X$}}.
%\end{align}
%}
%In other words, we associate to $A$ the set of attacks where, if $A$ does not contain the component $\pi_j$, then the attacks cannot change the value of $\pi_j$ when mutating states.
% \end{definition}
% 
% 
 \todo[inline]{We can refine this definition of attackers with $(\pi_j, Y_j)$, with $Y_j\subseteq X_j$, instead of just $\pi_j$. HoWEVER, I highly encourage against this, because it overcomplicates things unnecessarily.}
 \todo[inline]{I love writing $j\in n$, but this means enumeration should start from 0...I can probably use that in my language though}
 \begin{example}[Attackers of Example~\ref{ex:LatentBehaviour} and their Semantics]
 The carrier $3$ has only one component, the identity function $\id$, so there are only two attackers for this system: $\emptyset$ and $\set{\id}$; their corresponding attacks are: $\texttt{attacks}(\emptyset)=\set{\id}$ and $\texttt{attacks}(\set{\id})=3^3$. In other words, the $\emptyset$ attacker can only attack the system with the identity mutation (i.e., nothing, it is a passive attacker), while the attacker controlling the state can attack the system with whatever mutation they want.
 \todo[inline]{While the text above is 100\% correct, is it a mess to read.}
 \todo[inline]{UGH, maybe we'll have to change the example to a 4-state set (0,0),(1,0),(0,1), (1,1) such that $\gamma(a,b)=b$ and $0=(0,0), 1=(1,0)$ and $2=(1,1)$, and $(0,1)\xrightarrow{0}(0,0)$ and $(0,1)\xrightarrow{1}(1,0)$. DO NOTE THAT THERE ARE 256 attacks!!!! $4^4=256$. 
}
 \end{example}



\subsection{A Partial Order of Attackers}
\todo[inline]{We know how to quantify attackers in terms of exact latent behaviours, but latent behaviours themselves have an order (they are languages i.e. sets). What about the relationship among them? Do stronger attackers need to recognise more languages, what if a language implies another? how do attackers relate there then?}




%\begin{proposition}
%\label{sec:Incompleteness}
%Given an arbitrary $F$-coalgebra $\mathbb{X}=(X,c)$ and a behaviour $\rho\in \sigma F$, there may not exist a mutation $m\colon X\rightarrow X$ such that $\rho$ is a latent behaviour of $\mathbb{X}$ under $m$.
%\end{proposition}
%\begin{proof}
%We provide a counterexample for the opposite proposition, that is, there exists a mutation $m\colon X\rightarrow X$ such that $\rho$ is a latent behaviour of $\mathbb{X}$ under $m$, for all $F$-coalgebras and all behaviours in $\sigma F$. 
%Consider, for the functor $F=2\times \texttt{id}^2$, a single-state $F$-coalgebra that accepts all sequences; this $F$-coalgebra cannot display a latent behaviour different from its original behaviour.
%\end{proof}

We would like to consider two problems related to latent behaviours: 
\begin{itemize}
\item How can we use mutations ourselves to repurpose a system that is already been defined?
\item How can an attacker use mutations to force a behaviour they want?
\end{itemize}
\todo[inline]{Note that, ultimately, both questions need a method to solve an equation for a mutation. That is, given a target behaviour and an a source coalgebra, how do you solve the problem of finding a mutation that helps you display the behaviour you want? Is it even possible?}



